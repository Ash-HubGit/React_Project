{"ast":null,"code":"import IterResult from './iterresult';\nimport dateutil from './dateutil';\nimport { isArray } from './helpers';\nfunction argsMatch(left, right) {\n  if (Array.isArray(left)) {\n    if (!Array.isArray(right)) return false;\n    if (left.length !== right.length) return false;\n    return left.every(function (date, i) {\n      return date.getTime() === right[i].getTime();\n    });\n  }\n  if (left instanceof Date) {\n    return right instanceof Date && left.getTime() === right.getTime();\n  }\n  return left === right;\n}\nvar Cache = /** @class */function () {\n  function Cache() {\n    this.all = false;\n    this.before = [];\n    this.after = [];\n    this.between = [];\n  }\n  /**\n   * @param {String} what - all/before/after/between\n   * @param {Array,Date} value - an array of dates, one date, or null\n   * @param {Object?} args - _iter arguments\n   */\n  Cache.prototype._cacheAdd = function (what, value, args) {\n    if (value) {\n      value = value instanceof Date ? dateutil.clone(value) : dateutil.cloneDates(value);\n    }\n    if (what === 'all') {\n      this.all = value;\n    } else {\n      args._value = value;\n      this[what].push(args);\n    }\n  };\n  /**\n   * @return false - not in the cache\n   * @return null  - cached, but zero occurrences (before/after)\n   * @return Date  - cached (before/after)\n   * @return []    - cached, but zero occurrences (all/between)\n   * @return [Date1, DateN] - cached (all/between)\n   */\n  Cache.prototype._cacheGet = function (what, args) {\n    var cached = false;\n    var argsKeys = args ? Object.keys(args) : [];\n    var findCacheDiff = function (item) {\n      for (var i = 0; i < argsKeys.length; i++) {\n        var key = argsKeys[i];\n        if (!argsMatch(args[key], item[key])) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var cachedObject = this[what];\n    if (what === 'all') {\n      cached = this.all;\n    } else if (isArray(cachedObject)) {\n      // Let's see whether we've already called the\n      // 'what' method with the same 'args'\n      for (var i = 0; i < cachedObject.length; i++) {\n        var item = cachedObject[i];\n        if (argsKeys.length && findCacheDiff(item)) continue;\n        cached = item._value;\n        break;\n      }\n    }\n    if (!cached && this.all) {\n      // Not in the cache, but we already know all the occurrences,\n      // so we can find the correct dates from the cached ones.\n      var iterResult = new IterResult(what, args);\n      for (var i = 0; i < this.all.length; i++) {\n        if (!iterResult.accept(this.all[i])) break;\n      }\n      cached = iterResult.getValue();\n      this._cacheAdd(what, cached, args);\n    }\n    return isArray(cached) ? dateutil.cloneDates(cached) : cached instanceof Date ? dateutil.clone(cached) : cached;\n  };\n  return Cache;\n}();\nexport { Cache };","map":{"version":3,"mappings":"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","names":["IterResult","dateutil","isArray","argsMatch","left","right","Array","length","every","date","i","getTime","Date","Cache","what","value","args","clone","cloneDates","all","_value","push","cached","argsKeys","Object","keys","findCacheDiff","item","key","cachedObject","iterResult","accept","getValue","_cacheAdd"],"sources":["../../src/cache.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module","externalDependencies":[]}