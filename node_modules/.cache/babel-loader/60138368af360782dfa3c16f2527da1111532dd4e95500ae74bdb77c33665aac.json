{"ast":null,"code":"import { freqIsDailyOrGreater } from '../types';\nimport dateutil from '../dateutil';\nimport Iterinfo from '../iterinfo/index';\nimport { RRule } from '../rrule';\nimport { buildTimeset } from '../parseoptions';\nimport { notEmpty, includes, isPresent } from '../helpers';\nimport { DateWithZone } from '../datewithzone';\nimport { buildPoslist } from './poslist';\nimport { DateTime } from '../datetime';\nexport function iter(iterResult, options) {\n  var dtstart = options.dtstart,\n    freq = options.freq,\n    interval = options.interval,\n    until = options.until,\n    bysetpos = options.bysetpos;\n  var count = options.count;\n  if (count === 0 || interval === 0) {\n    return emitResult(iterResult);\n  }\n  var counterDate = DateTime.fromDate(dtstart);\n  var ii = new Iterinfo(options);\n  ii.rebuild(counterDate.year, counterDate.month);\n  var timeset = makeTimeset(ii, counterDate, options);\n  for (;;) {\n    var _a = ii.getdayset(freq)(counterDate.year, counterDate.month, counterDate.day),\n      dayset = _a[0],\n      start = _a[1],\n      end = _a[2];\n    var filtered = removeFilteredDays(dayset, start, end, ii, options);\n    if (notEmpty(bysetpos)) {\n      var poslist = buildPoslist(bysetpos, timeset, start, end, ii, dayset);\n      for (var j = 0; j < poslist.length; j++) {\n        var res = poslist[j];\n        if (until && res > until) {\n          return emitResult(iterResult);\n        }\n        if (res >= dtstart) {\n          var rezonedDate = rezoneIfNeeded(res, options);\n          if (!iterResult.accept(rezonedDate)) {\n            return emitResult(iterResult);\n          }\n          if (count) {\n            --count;\n            if (!count) {\n              return emitResult(iterResult);\n            }\n          }\n        }\n      }\n    } else {\n      for (var j = start; j < end; j++) {\n        var currentDay = dayset[j];\n        if (!isPresent(currentDay)) {\n          continue;\n        }\n        var date = dateutil.fromOrdinal(ii.yearordinal + currentDay);\n        for (var k = 0; k < timeset.length; k++) {\n          var time = timeset[k];\n          var res = dateutil.combine(date, time);\n          if (until && res > until) {\n            return emitResult(iterResult);\n          }\n          if (res >= dtstart) {\n            var rezonedDate = rezoneIfNeeded(res, options);\n            if (!iterResult.accept(rezonedDate)) {\n              return emitResult(iterResult);\n            }\n            if (count) {\n              --count;\n              if (!count) {\n                return emitResult(iterResult);\n              }\n            }\n          }\n        }\n      }\n    }\n    if (options.interval === 0) {\n      return emitResult(iterResult);\n    }\n    // Handle frequency and interval\n    counterDate.add(options, filtered);\n    if (counterDate.year > dateutil.MAXYEAR) {\n      return emitResult(iterResult);\n    }\n    if (!freqIsDailyOrGreater(freq)) {\n      timeset = ii.gettimeset(freq)(counterDate.hour, counterDate.minute, counterDate.second, 0);\n    }\n    ii.rebuild(counterDate.year, counterDate.month);\n  }\n}\nfunction isFiltered(ii, currentDay, options) {\n  var bymonth = options.bymonth,\n    byweekno = options.byweekno,\n    byweekday = options.byweekday,\n    byeaster = options.byeaster,\n    bymonthday = options.bymonthday,\n    bynmonthday = options.bynmonthday,\n    byyearday = options.byyearday;\n  return notEmpty(bymonth) && !includes(bymonth, ii.mmask[currentDay]) || notEmpty(byweekno) && !ii.wnomask[currentDay] || notEmpty(byweekday) && !includes(byweekday, ii.wdaymask[currentDay]) || notEmpty(ii.nwdaymask) && !ii.nwdaymask[currentDay] || byeaster !== null && !includes(ii.eastermask, currentDay) || (notEmpty(bymonthday) || notEmpty(bynmonthday)) && !includes(bymonthday, ii.mdaymask[currentDay]) && !includes(bynmonthday, ii.nmdaymask[currentDay]) || notEmpty(byyearday) && (currentDay < ii.yearlen && !includes(byyearday, currentDay + 1) && !includes(byyearday, -ii.yearlen + currentDay) || currentDay >= ii.yearlen && !includes(byyearday, currentDay + 1 - ii.yearlen) && !includes(byyearday, -ii.nextyearlen + currentDay - ii.yearlen));\n}\nfunction rezoneIfNeeded(date, options) {\n  return new DateWithZone(date, options.tzid).rezonedDate();\n}\nfunction emitResult(iterResult) {\n  return iterResult.getValue();\n}\nfunction removeFilteredDays(dayset, start, end, ii, options) {\n  var filtered = false;\n  for (var dayCounter = start; dayCounter < end; dayCounter++) {\n    var currentDay = dayset[dayCounter];\n    filtered = isFiltered(ii, currentDay, options);\n    if (filtered) dayset[currentDay] = null;\n  }\n  return filtered;\n}\nfunction makeTimeset(ii, counterDate, options) {\n  var freq = options.freq,\n    byhour = options.byhour,\n    byminute = options.byminute,\n    bysecond = options.bysecond;\n  if (freqIsDailyOrGreater(freq)) {\n    return buildTimeset(options);\n  }\n  if (freq >= RRule.HOURLY && notEmpty(byhour) && !includes(byhour, counterDate.hour) || freq >= RRule.MINUTELY && notEmpty(byminute) && !includes(byminute, counterDate.minute) || freq >= RRule.SECONDLY && notEmpty(bysecond) && !includes(bysecond, counterDate.second)) {\n    return [];\n  }\n  return ii.gettimeset(freq)(counterDate.hour, counterDate.minute, counterDate.second, counterDate.millisecond);\n}","map":{"version":3,"mappings":"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","names":["freqIsDailyOrGreater","dateutil","Iterinfo","RRule","buildTimeset","notEmpty","includes","isPresent","DateWithZone","buildPoslist","DateTime","iter","iterResult","options","freq","interval","until","bysetpos","count","emitResult","counterDate","fromDate","dtstart","ii","rebuild","year","month","timeset","makeTimeset","getdayset","day","dayset","start","end","filtered","removeFilteredDays","poslist","j","length","res","rezonedDate","rezoneIfNeeded","accept","currentDay","date","fromOrdinal","yearordinal","k","time","combine","add","MAXYEAR","gettimeset","hour","minute","second","isFiltered","byweekno","byweekday","byeaster","bymonthday","bynmonthday","byyearday","bymonth","mmask","wnomask","wdaymask","nwdaymask","eastermask","mdaymask","nmdaymask","yearlen","nextyearlen","tzid","getValue","dayCounter","byhour","byminute","bysecond","HOURLY","MINUTELY","SECONDLY","millisecond"],"sources":["../../../src/iter/index.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module","externalDependencies":[]}