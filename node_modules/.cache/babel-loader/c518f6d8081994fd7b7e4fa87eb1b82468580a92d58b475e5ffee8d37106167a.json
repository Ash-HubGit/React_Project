{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { RRule } from './rrule';\nimport { RRuleSet } from './rruleset';\nimport dateutil from './dateutil';\nimport { includes, split } from './helpers';\nimport { parseString, parseDtstart } from './parsestring';\n/**\n * RRuleStr\n * To parse a set of rrule strings\n */\nvar DEFAULT_OPTIONS = {\n  dtstart: null,\n  cache: false,\n  unfold: false,\n  forceset: false,\n  compatible: false,\n  tzid: null\n};\nexport function parseInput(s, options) {\n  var rrulevals = [];\n  var rdatevals = [];\n  var exrulevals = [];\n  var exdatevals = [];\n  var parsedDtstart = parseDtstart(s);\n  var dtstart = parsedDtstart.dtstart;\n  var tzid = parsedDtstart.tzid;\n  var lines = splitIntoLines(s, options.unfold);\n  lines.forEach(function (line) {\n    var _a;\n    if (!line) return;\n    var _b = breakDownLine(line),\n      name = _b.name,\n      parms = _b.parms,\n      value = _b.value;\n    switch (name.toUpperCase()) {\n      case 'RRULE':\n        if (parms.length) {\n          throw new Error(\"unsupported RRULE parm: \".concat(parms.join(',')));\n        }\n        rrulevals.push(parseString(line));\n        break;\n      case 'RDATE':\n        var _c = (_a = /RDATE(?:;TZID=([^:=]+))?/i.exec(line)) !== null && _a !== void 0 ? _a : [],\n          rdateTzid = _c[1];\n        if (rdateTzid && !tzid) {\n          tzid = rdateTzid;\n        }\n        rdatevals = rdatevals.concat(parseRDate(value, parms));\n        break;\n      case 'EXRULE':\n        if (parms.length) {\n          throw new Error(\"unsupported EXRULE parm: \".concat(parms.join(',')));\n        }\n        exrulevals.push(parseString(value));\n        break;\n      case 'EXDATE':\n        exdatevals = exdatevals.concat(parseRDate(value, parms));\n        break;\n      case 'DTSTART':\n        break;\n      default:\n        throw new Error('unsupported property: ' + name);\n    }\n  });\n  return {\n    dtstart: dtstart,\n    tzid: tzid,\n    rrulevals: rrulevals,\n    rdatevals: rdatevals,\n    exrulevals: exrulevals,\n    exdatevals: exdatevals\n  };\n}\nfunction buildRule(s, options) {\n  var _a = parseInput(s, options),\n    rrulevals = _a.rrulevals,\n    rdatevals = _a.rdatevals,\n    exrulevals = _a.exrulevals,\n    exdatevals = _a.exdatevals,\n    dtstart = _a.dtstart,\n    tzid = _a.tzid;\n  var noCache = options.cache === false;\n  if (options.compatible) {\n    options.forceset = true;\n    options.unfold = true;\n  }\n  if (options.forceset || rrulevals.length > 1 || rdatevals.length || exrulevals.length || exdatevals.length) {\n    var rset_1 = new RRuleSet(noCache);\n    rset_1.dtstart(dtstart);\n    rset_1.tzid(tzid || undefined);\n    rrulevals.forEach(function (val) {\n      rset_1.rrule(new RRule(groomRruleOptions(val, dtstart, tzid), noCache));\n    });\n    rdatevals.forEach(function (date) {\n      rset_1.rdate(date);\n    });\n    exrulevals.forEach(function (val) {\n      rset_1.exrule(new RRule(groomRruleOptions(val, dtstart, tzid), noCache));\n    });\n    exdatevals.forEach(function (date) {\n      rset_1.exdate(date);\n    });\n    if (options.compatible && options.dtstart) rset_1.rdate(dtstart);\n    return rset_1;\n  }\n  var val = rrulevals[0] || {};\n  return new RRule(groomRruleOptions(val, val.dtstart || options.dtstart || dtstart, val.tzid || options.tzid || tzid), noCache);\n}\nexport function rrulestr(s, options) {\n  if (options === void 0) {\n    options = {};\n  }\n  return buildRule(s, initializeOptions(options));\n}\nfunction groomRruleOptions(val, dtstart, tzid) {\n  return __assign(__assign({}, val), {\n    dtstart: dtstart,\n    tzid: tzid\n  });\n}\nfunction initializeOptions(options) {\n  var invalid = [];\n  var keys = Object.keys(options);\n  var defaultKeys = Object.keys(DEFAULT_OPTIONS);\n  keys.forEach(function (key) {\n    if (!includes(defaultKeys, key)) invalid.push(key);\n  });\n  if (invalid.length) {\n    throw new Error('Invalid options: ' + invalid.join(', '));\n  }\n  return __assign(__assign({}, DEFAULT_OPTIONS), options);\n}\nfunction extractName(line) {\n  if (line.indexOf(':') === -1) {\n    return {\n      name: 'RRULE',\n      value: line\n    };\n  }\n  var _a = split(line, ':', 1),\n    name = _a[0],\n    value = _a[1];\n  return {\n    name: name,\n    value: value\n  };\n}\nfunction breakDownLine(line) {\n  var _a = extractName(line),\n    name = _a.name,\n    value = _a.value;\n  var parms = name.split(';');\n  if (!parms) throw new Error('empty property name');\n  return {\n    name: parms[0].toUpperCase(),\n    parms: parms.slice(1),\n    value: value\n  };\n}\nfunction splitIntoLines(s, unfold) {\n  if (unfold === void 0) {\n    unfold = false;\n  }\n  s = s && s.trim();\n  if (!s) throw new Error('Invalid empty string');\n  // More info about 'unfold' option\n  // Go head to http://www.ietf.org/rfc/rfc2445.txt\n  if (!unfold) {\n    return s.split(/\\s/);\n  }\n  var lines = s.split('\\n');\n  var i = 0;\n  while (i < lines.length) {\n    // TODO\n    var line = lines[i] = lines[i].replace(/\\s+$/g, '');\n    if (!line) {\n      lines.splice(i, 1);\n    } else if (i > 0 && line[0] === ' ') {\n      lines[i - 1] += line.slice(1);\n      lines.splice(i, 1);\n    } else {\n      i += 1;\n    }\n  }\n  return lines;\n}\nfunction validateDateParm(parms) {\n  parms.forEach(function (parm) {\n    if (!/(VALUE=DATE(-TIME)?)|(TZID=)/.test(parm)) {\n      throw new Error('unsupported RDATE/EXDATE parm: ' + parm);\n    }\n  });\n}\nfunction parseRDate(rdateval, parms) {\n  validateDateParm(parms);\n  return rdateval.split(',').map(function (datestr) {\n    return dateutil.untilStringToDate(datestr);\n  });\n}","map":{"version":3,"mappings":"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","names":["RRule","RRuleSet","dateutil","includes","split","parseString","parseDtstart","DEFAULT_OPTIONS","dtstart","cache","unfold","forceset","compatible","tzid","parseInput","s","options","rrulevals","rdatevals","exrulevals","exdatevals","parsedDtstart","lines","splitIntoLines","forEach","line","breakDownLine","name","parms","value","toUpperCase","length","Error","join","push","exec","rdateTzid","concat","parseRDate","buildRule","noCache","rset_1","undefined","val","rrule","groomRruleOptions","date","rdate","exrule","exdate","rrulestr","initializeOptions","invalid","keys","Object","defaultKeys","key","extractName","indexOf","slice","trim","i","replace","splice","validateDateParm","parm","test","rdateval","map","datestr","untilStringToDate"],"sources":["../../src/rrulestr.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module","externalDependencies":[]}