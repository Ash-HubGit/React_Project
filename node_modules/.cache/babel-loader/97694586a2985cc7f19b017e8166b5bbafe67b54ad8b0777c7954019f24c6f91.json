{"ast":null,"code":"import dateutil from '../dateutil';\nimport { notEmpty, repeat, range, isPresent } from '../helpers';\nimport { Frequency } from '../types';\nimport { rebuildYear } from './yearinfo';\nimport { rebuildMonth } from './monthinfo';\nimport { easter } from './easter';\nimport { Time } from '../datetime';\n// =============================================================================\n// Iterinfo\n// =============================================================================\nvar Iterinfo = /** @class */function () {\n  // eslint-disable-next-line no-empty-function\n  function Iterinfo(options) {\n    this.options = options;\n  }\n  Iterinfo.prototype.rebuild = function (year, month) {\n    var options = this.options;\n    if (year !== this.lastyear) {\n      this.yearinfo = rebuildYear(year, options);\n    }\n    if (notEmpty(options.bynweekday) && (month !== this.lastmonth || year !== this.lastyear)) {\n      var _a = this.yearinfo,\n        yearlen = _a.yearlen,\n        mrange = _a.mrange,\n        wdaymask = _a.wdaymask;\n      this.monthinfo = rebuildMonth(year, month, yearlen, mrange, wdaymask, options);\n    }\n    if (isPresent(options.byeaster)) {\n      this.eastermask = easter(year, options.byeaster);\n    }\n  };\n  Object.defineProperty(Iterinfo.prototype, \"lastyear\", {\n    get: function () {\n      return this.monthinfo ? this.monthinfo.lastyear : null;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"lastmonth\", {\n    get: function () {\n      return this.monthinfo ? this.monthinfo.lastmonth : null;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"yearlen\", {\n    get: function () {\n      return this.yearinfo.yearlen;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"yearordinal\", {\n    get: function () {\n      return this.yearinfo.yearordinal;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"mrange\", {\n    get: function () {\n      return this.yearinfo.mrange;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"wdaymask\", {\n    get: function () {\n      return this.yearinfo.wdaymask;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"mmask\", {\n    get: function () {\n      return this.yearinfo.mmask;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"wnomask\", {\n    get: function () {\n      return this.yearinfo.wnomask;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"nwdaymask\", {\n    get: function () {\n      return this.monthinfo ? this.monthinfo.nwdaymask : [];\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"nextyearlen\", {\n    get: function () {\n      return this.yearinfo.nextyearlen;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"mdaymask\", {\n    get: function () {\n      return this.yearinfo.mdaymask;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Object.defineProperty(Iterinfo.prototype, \"nmdaymask\", {\n    get: function () {\n      return this.yearinfo.nmdaymask;\n    },\n    enumerable: false,\n    configurable: true\n  });\n  Iterinfo.prototype.ydayset = function () {\n    return [range(this.yearlen), 0, this.yearlen];\n  };\n  Iterinfo.prototype.mdayset = function (_, month) {\n    var start = this.mrange[month - 1];\n    var end = this.mrange[month];\n    var set = repeat(null, this.yearlen);\n    for (var i = start; i < end; i++) set[i] = i;\n    return [set, start, end];\n  };\n  Iterinfo.prototype.wdayset = function (year, month, day) {\n    // We need to handle cross-year weeks here.\n    var set = repeat(null, this.yearlen + 7);\n    var i = dateutil.toOrdinal(new Date(Date.UTC(year, month - 1, day))) - this.yearordinal;\n    var start = i;\n    for (var j = 0; j < 7; j++) {\n      set[i] = i;\n      ++i;\n      if (this.wdaymask[i] === this.options.wkst) break;\n    }\n    return [set, start, i];\n  };\n  Iterinfo.prototype.ddayset = function (year, month, day) {\n    var set = repeat(null, this.yearlen);\n    var i = dateutil.toOrdinal(new Date(Date.UTC(year, month - 1, day))) - this.yearordinal;\n    set[i] = i;\n    return [set, i, i + 1];\n  };\n  Iterinfo.prototype.htimeset = function (hour, _, second, millisecond) {\n    var _this = this;\n    var set = [];\n    this.options.byminute.forEach(function (minute) {\n      set = set.concat(_this.mtimeset(hour, minute, second, millisecond));\n    });\n    dateutil.sort(set);\n    return set;\n  };\n  Iterinfo.prototype.mtimeset = function (hour, minute, _, millisecond) {\n    var set = this.options.bysecond.map(function (second) {\n      return new Time(hour, minute, second, millisecond);\n    });\n    dateutil.sort(set);\n    return set;\n  };\n  Iterinfo.prototype.stimeset = function (hour, minute, second, millisecond) {\n    return [new Time(hour, minute, second, millisecond)];\n  };\n  Iterinfo.prototype.getdayset = function (freq) {\n    switch (freq) {\n      case Frequency.YEARLY:\n        return this.ydayset.bind(this);\n      case Frequency.MONTHLY:\n        return this.mdayset.bind(this);\n      case Frequency.WEEKLY:\n        return this.wdayset.bind(this);\n      case Frequency.DAILY:\n        return this.ddayset.bind(this);\n      default:\n        return this.ddayset.bind(this);\n    }\n  };\n  Iterinfo.prototype.gettimeset = function (freq) {\n    switch (freq) {\n      case Frequency.HOURLY:\n        return this.htimeset.bind(this);\n      case Frequency.MINUTELY:\n        return this.mtimeset.bind(this);\n      case Frequency.SECONDLY:\n        return this.stimeset.bind(this);\n    }\n  };\n  return Iterinfo;\n}();\nexport default Iterinfo;","map":{"version":3,"mappings":"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","names":["dateutil","notEmpty","repeat","range","isPresent","Frequency","rebuildYear","rebuildMonth","easter","Time","options","Iterinfo","year","month","lastyear","yearinfo","bynweekday","lastmonth","yearlen","mrange","wdaymask","monthinfo","byeaster","eastermask","Object","yearordinal","mmask","wnomask","nwdaymask","nextyearlen","mdaymask","nmdaymask","_","start","end","set","i","day","toOrdinal","Date","UTC","j","wkst","hour","second","millisecond","byminute","forEach","minute","concat","_this","mtimeset","sort","bysecond","map","freq","YEARLY","ydayset","bind","MONTHLY","mdayset","WEEKLY","wdayset","DAILY","ddayset","HOURLY","htimeset","MINUTELY","SECONDLY","stimeset"],"sources":["../../../src/iterinfo/index.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module","externalDependencies":[]}