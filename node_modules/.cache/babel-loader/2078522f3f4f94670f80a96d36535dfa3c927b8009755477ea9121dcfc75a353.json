{"ast":null,"code":"import { __assign } from \"tslib\";\nimport { Frequency } from './types';\nimport { Weekday } from './weekday';\nimport dateutil from './dateutil';\nimport { Days } from './rrule';\nexport function parseString(rfcString) {\n  var options = rfcString.split('\\n').map(parseLine).filter(function (x) {\n    return x !== null;\n  });\n  return __assign(__assign({}, options[0]), options[1]);\n}\nexport function parseDtstart(line) {\n  var options = {};\n  var dtstartWithZone = /DTSTART(?:;TZID=([^:=]+?))?(?::|=)([^;\\s]+)/i.exec(line);\n  if (!dtstartWithZone) {\n    return options;\n  }\n  var tzid = dtstartWithZone[1],\n    dtstart = dtstartWithZone[2];\n  if (tzid) {\n    options.tzid = tzid;\n  }\n  options.dtstart = dateutil.untilStringToDate(dtstart);\n  return options;\n}\nfunction parseLine(rfcString) {\n  rfcString = rfcString.replace(/^\\s+|\\s+$/, '');\n  if (!rfcString.length) return null;\n  var header = /^([A-Z]+?)[:;]/.exec(rfcString.toUpperCase());\n  if (!header) {\n    return parseRrule(rfcString);\n  }\n  var key = header[1];\n  switch (key.toUpperCase()) {\n    case 'RRULE':\n    case 'EXRULE':\n      return parseRrule(rfcString);\n    case 'DTSTART':\n      return parseDtstart(rfcString);\n    default:\n      throw new Error(\"Unsupported RFC prop \".concat(key, \" in \").concat(rfcString));\n  }\n}\nfunction parseRrule(line) {\n  var strippedLine = line.replace(/^RRULE:/i, '');\n  var options = parseDtstart(strippedLine);\n  var attrs = line.replace(/^(?:RRULE|EXRULE):/i, '').split(';');\n  attrs.forEach(function (attr) {\n    var _a = attr.split('='),\n      key = _a[0],\n      value = _a[1];\n    switch (key.toUpperCase()) {\n      case 'FREQ':\n        options.freq = Frequency[value.toUpperCase()];\n        break;\n      case 'WKST':\n        options.wkst = Days[value.toUpperCase()];\n        break;\n      case 'COUNT':\n      case 'INTERVAL':\n      case 'BYSETPOS':\n      case 'BYMONTH':\n      case 'BYMONTHDAY':\n      case 'BYYEARDAY':\n      case 'BYWEEKNO':\n      case 'BYHOUR':\n      case 'BYMINUTE':\n      case 'BYSECOND':\n        var num = parseNumber(value);\n        var optionKey = key.toLowerCase();\n        // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n        // @ts-ignore\n        options[optionKey] = num;\n        break;\n      case 'BYWEEKDAY':\n      case 'BYDAY':\n        options.byweekday = parseWeekday(value);\n        break;\n      case 'DTSTART':\n      case 'TZID':\n        // for backwards compatibility\n        var dtstart = parseDtstart(line);\n        options.tzid = dtstart.tzid;\n        options.dtstart = dtstart.dtstart;\n        break;\n      case 'UNTIL':\n        options.until = dateutil.untilStringToDate(value);\n        break;\n      case 'BYEASTER':\n        options.byeaster = Number(value);\n        break;\n      default:\n        throw new Error(\"Unknown RRULE property '\" + key + \"'\");\n    }\n  });\n  return options;\n}\nfunction parseNumber(value) {\n  if (value.indexOf(',') !== -1) {\n    var values = value.split(',');\n    return values.map(parseIndividualNumber);\n  }\n  return parseIndividualNumber(value);\n}\nfunction parseIndividualNumber(value) {\n  if (/^[+-]?\\d+$/.test(value)) {\n    return Number(value);\n  }\n  return value;\n}\nfunction parseWeekday(value) {\n  var days = value.split(',');\n  return days.map(function (day) {\n    if (day.length === 2) {\n      // MO, TU, ...\n      return Days[day]; // wday instanceof Weekday\n    }\n    // -1MO, +3FR, 1SO, 13TU ...\n    var parts = day.match(/^([+-]?\\d{1,2})([A-Z]{2})$/);\n    if (!parts || parts.length < 3) {\n      throw new SyntaxError(\"Invalid weekday string: \".concat(day));\n    }\n    var n = Number(parts[1]);\n    var wdaypart = parts[2];\n    var wday = Days[wdaypart].weekday;\n    return new Weekday(wday, n);\n  });\n}","map":{"version":3,"mappings":"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","names":["Frequency","Weekday","dateutil","Days","parseString","rfcString","options","split","map","parseLine","filter","x","parseDtstart","line","dtstartWithZone","exec","dtstart","tzid","untilStringToDate","replace","length","header","toUpperCase","parseRrule","key","Error","strippedLine","attrs","forEach","attr","value","freq","wkst","num","parseNumber","optionKey","toLowerCase","byweekday","parseWeekday","until","byeaster","Number","indexOf","values","parseIndividualNumber","test","days","day","parts","match","SyntaxError","n","wdaypart","wday","weekday"],"sources":["../../src/parsestring.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module","externalDependencies":[]}