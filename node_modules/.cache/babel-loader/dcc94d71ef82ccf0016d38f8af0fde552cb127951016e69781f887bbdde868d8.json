{"ast":null,"code":"import { __extends } from \"tslib\";\nimport { RRule } from './rrule';\nimport dateutil from './dateutil';\nimport { includes } from './helpers';\nimport { iterSet } from './iterset';\nimport { rrulestr } from './rrulestr';\nimport { optionsToString } from './optionstostring';\nfunction createGetterSetter(fieldName) {\n  var _this = this;\n  return function (field) {\n    if (field !== undefined) {\n      _this[\"_\".concat(fieldName)] = field;\n    }\n    if (_this[\"_\".concat(fieldName)] !== undefined) {\n      return _this[\"_\".concat(fieldName)];\n    }\n    for (var i = 0; i < _this._rrule.length; i++) {\n      var field_1 = _this._rrule[i].origOptions[fieldName];\n      if (field_1) {\n        return field_1;\n      }\n    }\n  };\n}\nvar RRuleSet = /** @class */function (_super) {\n  __extends(RRuleSet, _super);\n  /**\n   *\n   * @param {Boolean?} noCache\n   * The same stratagy as RRule on cache, default to false\n   * @constructor\n   */\n  function RRuleSet(noCache) {\n    if (noCache === void 0) {\n      noCache = false;\n    }\n    var _this = _super.call(this, {}, noCache) || this;\n    _this.dtstart = createGetterSetter.apply(_this, ['dtstart']);\n    _this.tzid = createGetterSetter.apply(_this, ['tzid']);\n    _this._rrule = [];\n    _this._rdate = [];\n    _this._exrule = [];\n    _this._exdate = [];\n    return _this;\n  }\n  RRuleSet.prototype._iter = function (iterResult) {\n    return iterSet(iterResult, this._rrule, this._exrule, this._rdate, this._exdate, this.tzid());\n  };\n  /**\n   * Adds an RRule to the set\n   *\n   * @param {RRule}\n   */\n  RRuleSet.prototype.rrule = function (rrule) {\n    _addRule(rrule, this._rrule);\n  };\n  /**\n   * Adds an EXRULE to the set\n   *\n   * @param {RRule}\n   */\n  RRuleSet.prototype.exrule = function (rrule) {\n    _addRule(rrule, this._exrule);\n  };\n  /**\n   * Adds an RDate to the set\n   *\n   * @param {Date}\n   */\n  RRuleSet.prototype.rdate = function (date) {\n    _addDate(date, this._rdate);\n  };\n  /**\n   * Adds an EXDATE to the set\n   *\n   * @param {Date}\n   */\n  RRuleSet.prototype.exdate = function (date) {\n    _addDate(date, this._exdate);\n  };\n  /**\n   * Get list of included rrules in this recurrence set.\n   *\n   * @return List of rrules\n   */\n  RRuleSet.prototype.rrules = function () {\n    return this._rrule.map(function (e) {\n      return rrulestr(e.toString());\n    });\n  };\n  /**\n   * Get list of excluded rrules in this recurrence set.\n   *\n   * @return List of exrules\n   */\n  RRuleSet.prototype.exrules = function () {\n    return this._exrule.map(function (e) {\n      return rrulestr(e.toString());\n    });\n  };\n  /**\n   * Get list of included datetimes in this recurrence set.\n   *\n   * @return List of rdates\n   */\n  RRuleSet.prototype.rdates = function () {\n    return this._rdate.map(function (e) {\n      return new Date(e.getTime());\n    });\n  };\n  /**\n   * Get list of included datetimes in this recurrence set.\n   *\n   * @return List of exdates\n   */\n  RRuleSet.prototype.exdates = function () {\n    return this._exdate.map(function (e) {\n      return new Date(e.getTime());\n    });\n  };\n  RRuleSet.prototype.valueOf = function () {\n    var result = [];\n    if (!this._rrule.length && this._dtstart) {\n      result = result.concat(optionsToString({\n        dtstart: this._dtstart\n      }));\n    }\n    this._rrule.forEach(function (rrule) {\n      result = result.concat(rrule.toString().split('\\n'));\n    });\n    this._exrule.forEach(function (exrule) {\n      result = result.concat(exrule.toString().split('\\n').map(function (line) {\n        return line.replace(/^RRULE:/, 'EXRULE:');\n      }).filter(function (line) {\n        return !/^DTSTART/.test(line);\n      }));\n    });\n    if (this._rdate.length) {\n      result.push(rdatesToString('RDATE', this._rdate, this.tzid()));\n    }\n    if (this._exdate.length) {\n      result.push(rdatesToString('EXDATE', this._exdate, this.tzid()));\n    }\n    return result;\n  };\n  /**\n   * to generate recurrence field such as:\n   * DTSTART:19970902T010000Z\n   * RRULE:FREQ=YEARLY;COUNT=2;BYDAY=TU\n   * RRULE:FREQ=YEARLY;COUNT=1;BYDAY=TH\n   */\n  RRuleSet.prototype.toString = function () {\n    return this.valueOf().join('\\n');\n  };\n  /**\n   * Create a new RRuleSet Object completely base on current instance\n   */\n  RRuleSet.prototype.clone = function () {\n    var rrs = new RRuleSet(!!this._cache);\n    this._rrule.forEach(function (rule) {\n      return rrs.rrule(rule.clone());\n    });\n    this._exrule.forEach(function (rule) {\n      return rrs.exrule(rule.clone());\n    });\n    this._rdate.forEach(function (date) {\n      return rrs.rdate(new Date(date.getTime()));\n    });\n    this._exdate.forEach(function (date) {\n      return rrs.exdate(new Date(date.getTime()));\n    });\n    return rrs;\n  };\n  return RRuleSet;\n}(RRule);\nexport { RRuleSet };\nfunction _addRule(rrule, collection) {\n  if (!(rrule instanceof RRule)) {\n    throw new TypeError(String(rrule) + ' is not RRule instance');\n  }\n  if (!includes(collection.map(String), String(rrule))) {\n    collection.push(rrule);\n  }\n}\nfunction _addDate(date, collection) {\n  if (!(date instanceof Date)) {\n    throw new TypeError(String(date) + ' is not Date instance');\n  }\n  if (!includes(collection.map(Number), Number(date))) {\n    collection.push(date);\n    dateutil.sort(collection);\n  }\n}\nfunction rdatesToString(param, rdates, tzid) {\n  var isUTC = !tzid || tzid.toUpperCase() === 'UTC';\n  var header = isUTC ? \"\".concat(param, \":\") : \"\".concat(param, \";TZID=\").concat(tzid, \":\");\n  var dateString = rdates.map(function (rdate) {\n    return dateutil.timeToUntilString(rdate.valueOf(), isUTC);\n  }).join(',');\n  return \"\".concat(header).concat(dateString);\n}","map":{"version":3,"mappings":"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","names":["RRule","dateutil","includes","iterSet","rrulestr","optionsToString","createGetterSetter","fieldName","field","undefined","_this","i","_rrule","length","field_1","origOptions","__extends","noCache","_super","apply","_rdate","_exrule","_exdate","RRuleSet","iterResult","tzid","rrule","_addRule","date","_addDate","map","e","toString","Date","getTime","result","_dtstart","concat","dtstart","forEach","split","exrule","line","replace","filter","test","push","rdatesToString","valueOf","join","rrs","_cache","rule","clone","rdate","exdate","collection","TypeError","String","Number","sort","param","rdates","isUTC","toUpperCase","header","dateString","timeToUntilString"],"sources":["../../src/rruleset.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module","externalDependencies":[]}